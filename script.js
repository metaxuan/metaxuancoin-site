const translations = {
  "en": {
    "start": "Start Transfer",
    "title": "MetaXuan Coin",
    "address": "Recipient Address",
    "amount": "Amount",
    "enterAddress": "Enter recipient address",
    "enterAmount": "Enter amount",
    "send": "Send",
    "back": "Back",
    "balance": "Wallet Balance",
    "connect": "Connect Wallet",
    "connected": "Wallet Connected",
    "network": "Network",
    "ethBalance": "ETH Balance",
    "tokenBalance": "MXN Balance"
  },
  "zh-TW": {
    "start": "é–‹å§‹è½‰å¸³",
    "title": "ç„å…ƒå¹£",
    "address": "æ¥æ”¶åœ°å€",
    "amount": "è½‰å¸³é‡‘é¡",
    "enterAddress": "è«‹è¼¸å…¥æ¥æ”¶åœ°å€",
    "enterAmount": "è«‹è¼¸å…¥é‡‘é¡",
    "send": "è½‰å¸³",
    "back": "è¿”å›",
    "balance": "éŒ¢åŒ…é¤˜é¡",
    "connect": "é€£æ¥éŒ¢åŒ…",
    "connected": "éŒ¢åŒ…å·²é€£æ¥",
    "network": "ç¶²è·¯",
    "ethBalance": "ETH é¤˜é¡",
    "tokenBalance": "MXN é¤˜é¡"
  },
  "zh-CN": {
    "start": "å¼€å§‹è½¬è´¦",
    "title": "ç„å…ƒå¸",
    "address": "æ¥æ”¶åœ°å€",
    "amount": "è½¬è´¦é‡‘é¢",
    "enterAddress": "è¯·è¾“å…¥æ¥æ”¶åœ°å€",
    "enterAmount": "è¯·è¾“å…¥é‡‘é¢",
    "send": "è½¬è´¦",
    "back": "è¿”å›",
    "balance": "é’±åŒ…ä½™é¢",
    "connect": "è¿æ¥é’±åŒ…",
    "connected": "é’±åŒ…å·²è¿æ¥",
    "network": "ç½‘ç»œ",
    "ethBalance": "ETH ä½™é¢",
    "tokenBalance": "MXN ä½™é¢"
  },
  "ja": {
    "start": "é€é‡‘é–‹å§‹",
    "title": "ãƒ¡ã‚¿ã‚·ãƒ¥ã‚¢ãƒ³ã‚³ã‚¤ãƒ³",
    "address": "å—å–ã‚¢ãƒ‰ãƒ¬ã‚¹",
    "amount": "é€é‡‘é¡",
    "enterAddress": "ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›",
    "enterAmount": "é‡‘é¡ã‚’å…¥åŠ›",
    "send": "é€é‡‘",
    "back": "æˆ»ã‚‹",
    "balance": "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ®‹é«˜",
    "connect": "ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶š",
    "connected": "æ¥ç¶šæ¸ˆã¿",
    "network": "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯",
    "ethBalance": "ETH æ®‹é«˜",
    "tokenBalance": "MXN æ®‹é«˜"
  },
  "ko": {
    "start": "ì†¡ê¸ˆ ì‹œì‘",
    "title": "ë©”íƒ€ì‰¬ì•ˆì½”ì¸",
    "address": "ìˆ˜ì‹  ì£¼ì†Œ",
    "amount": "ì†¡ê¸ˆ ê¸ˆì•¡",
    "enterAddress": "ìˆ˜ì‹  ì£¼ì†Œ ì…ë ¥",
    "enterAmount": "ê¸ˆì•¡ ì…ë ¥",
    "send": "ì†¡ê¸ˆ",
    "back": "ë’¤ë¡œê°€ê¸°",
    "balance": "ì§€ê°‘ ì”ì•¡",
    "connect": "ì§€ê°‘ ì—°ê²°",
    "connected": "ì§€ê°‘ ì—°ê²°ë¨",
    "network": "ë„¤íŠ¸ì›Œí¬",
    "ethBalance": "ETH ì”ì•¡",
    "tokenBalance": "MXN ì”ì•¡"
  },
  "es": {
    "start": "Iniciar transferencia",
    "title": "Moneda MetaXuan",
    "address": "DirecciÃ³n del destinatario",
    "amount": "Monto",
    "enterAddress": "Ingrese la direcciÃ³n",
    "enterAmount": "Ingrese el monto",
    "send": "Enviar",
    "back": "AtrÃ¡s",
    "balance": "Saldo de billetera",
    "connect": "Conectar billetera",
    "connected": "Billetera conectada",
    "network": "Red",
    "ethBalance": "Saldo ETH",
    "tokenBalance": "Saldo MXN"
  },
  "th": {
    "start": "à¹€à¸£à¸´à¹ˆà¸¡à¹‚à¸­à¸™",
    "title": "à¹€à¸«à¸£à¸µà¸¢à¸à¹€à¸¡à¸•à¸²à¸‹à¸§à¸™",
    "address": "à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸œà¸¹à¹‰à¸£à¸±à¸š",
    "amount": "à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™",
    "enterAddress": "à¸à¸£à¸­à¸à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ",
    "enterAmount": "à¸à¸£à¸­à¸à¸ˆà¸³à¸™à¸§à¸™",
    "send": "à¹‚à¸­à¸™",
    "back": "à¸¢à¹‰à¸­à¸™à¸à¸¥à¸±à¸š",
    "balance": "à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­à¸à¸£à¸°à¹€à¸›à¹‹à¸²",
    "connect": "à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸£à¸°à¹€à¸›à¹‹à¸²",
    "connected": "à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹à¸¥à¹‰à¸§",
    "network": "à¹€à¸„à¸£à¸·à¸­à¸‚à¹ˆà¸²à¸¢",
    "ethBalance": "à¸¢à¸­à¸” ETH",
    "tokenBalance": "à¸¢à¸­à¸” MXN"
  },
  "vi": {
    "start": "Báº¯t Ä‘áº§u chuyá»ƒn khoáº£n",
    "title": "MetaXuan Coin",
    "address": "Äá»‹a chá»‰ ngÆ°á»i nháº­n",
    "amount": "Sá»‘ tiá»n",
    "enterAddress": "Nháº­p Ä‘á»‹a chá»‰ ngÆ°á»i nháº­n",
    "enterAmount": "Nháº­p sá»‘ tiá»n",
    "send": "Gá»­i",
    "back": "Quay láº¡i",
    "balance": "Sá»‘ dÆ° vÃ­",
    "connect": "Káº¿t ná»‘i vÃ­",
    "connected": "VÃ­ Ä‘Ã£ káº¿t ná»‘i",
    "network": "Máº¡ng",
    "ethBalance": "Sá»‘ dÆ° ETH",
    "tokenBalance": "Sá»‘ dÆ° MXN"
  },
  "fr": {
    "start": "Commencer le transfert",
    "title": "PiÃ¨ce MetaXuan",
    "address": "Adresse du destinataire",
    "amount": "Montant",
    "enterAddress": "Entrez l'adresse du destinataire",
    "enterAmount": "Entrez le montant",
    "send": "Envoyer",
    "back": "Retour",
    "balance": "Solde du portefeuille",
    "connect": "Connecter le portefeuille",
    "connected": "Portefeuille connectÃ©",
    "network": "RÃ©seau",
    "ethBalance": "Solde ETH",
    "tokenBalance": "Solde MXN"
  },
  "de": {
    "start": "Ãœberweisung starten",
    "title": "MetaXuan MÃ¼nze",
    "address": "EmpfÃ¤ngeradresse",
    "amount": "Betrag",
    "enterAddress": "EmpfÃ¤ngeradresse eingeben",
    "enterAmount": "Betrag eingeben",
    "send": "Senden",
    "back": "ZurÃ¼ck",
    "balance": "Wallet-Guthaben",
    "connect": "Wallet verbinden",
    "connected": "Wallet verbunden",
    "network": "Netzwerk",
    "ethBalance": "ETH-Guthaben",
    "tokenBalance": "MXN-Guthaben"
  },
  "hi": {
    "start": "à¤¸à¥à¤¥à¤¾à¤¨à¤¾à¤‚à¤¤à¤°à¤£ à¤ªà¥à¤°à¤¾à¤°à¤‚à¤­ à¤•à¤°à¥‡à¤‚",
    "title": "à¤®à¥‡à¤Ÿà¤¾ à¤œà¤¼à¥à¤†à¤¨ à¤¸à¤¿à¤•à¥à¤•à¤¾",
    "address": "à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤•à¤°à¥à¤¤à¤¾ à¤ªà¤¤à¤¾",
    "amount": "à¤°à¤¾à¤¶à¤¿",
    "enterAddress": "à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤à¤•à¤°à¥à¤¤à¤¾ à¤•à¤¾ à¤ªà¤¤à¤¾ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
    "enterAmount": "à¤°à¤¾à¤¶à¤¿ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚",
    "send": "à¤­à¥‡à¤œà¥‡à¤‚",
    "back": "à¤µà¤¾à¤ªà¤¸",
    "balance": "à¤µà¥‰à¤²à¥‡à¤Ÿ à¤¬à¥ˆà¤²à¥‡à¤‚à¤¸",
    "connect": "à¤µà¥‰à¤²à¥‡à¤Ÿ à¤•à¤¨à¥‡à¤•à¥à¤Ÿ à¤•à¤°à¥‡à¤‚",
    "connected": "à¤µà¥‰à¤²à¥‡à¤Ÿ à¤œà¥à¤¡à¤¼à¤¾ à¤¹à¥à¤†",
    "network": "à¤¨à¥‡à¤Ÿà¤µà¤°à¥à¤•",
    "ethBalance": "ETH à¤¶à¥‡à¤·",
    "tokenBalance": "MXN à¤¶à¥‡à¤·"
  }
};
  "en": {
    "btn": "ğŸŒ View Vision",
    "short": "To listen to the voices of the world with compassion and wisdom.",
    "medium": "MetaXuan Coin is a bridge of kindness, allowing goodwill to flow freely across borders. We believe every gentle force can change a corner of the world.",
    "long": "MetaXuan Coin is a global decentralized asset dedicated to fair resource allocation and transparent charity. Inspired by the mantra 'à¥ à¤®à¤£à¤¿ à¤ªà¤¦à¥à¤®à¥‡ à¤¹à¥‚à¤‚', we use blockchain to ensure every act of kindness is seen, recorded, and amplified for lasting impact."
  },
  "zh-TW": {
    "btn": "ğŸŒ è§€çœ‹é¡˜æ™¯",
    "short": "å‚¾è½ä¸–é–“çš„è²éŸ³ï¼Œä¸¦ä»¥æ…ˆæ‚²èˆ‡æ™ºæ…§ï¼Œå›æ‡‰æ¯ä¸€ä»½éœ€è¦ã€‚",
    "medium": "ç„å…ƒå¹£æ˜¯ä¸€é“é€£æ¥äººå¿ƒçš„å…‰ï¼Œè®“å…¨çƒçš„å–„æ„ç„¡åœ‹ç•Œåœ°æµå‹•ã€‚æˆ‘å€‘ç›¸ä¿¡ï¼Œæ¯ä¸€ä»½æº«æŸ”çš„åŠ›é‡ï¼Œéƒ½èƒ½æ”¹è®Šä¸–ç•Œçš„è§’è½ã€‚",
    "long": "ç„å…ƒå¹£ï¼ˆMetaXuan Coinï¼‰æ˜¯ä¸€é …å…¨çƒæ€§å»ä¸­å¿ƒåŒ–è³‡ç”¢ï¼Œè‡´åŠ›æ–¼ä¿ƒé€²å…¬å¹³çš„è³‡æºåˆ†é…èˆ‡æ…ˆå–„é€æ˜ã€‚æˆ‘å€‘ä»¥å…­å­—å¤§æ˜å’’ã€Œà¥ à¤®à¤£à¤¿ à¤ªà¤¦à¥à¤®à¥‡ à¤¹à¥‚à¤‚ã€çš„ç²¾ç¥ç‚ºéˆæ„Ÿï¼Œçµåˆå€å¡ŠéˆæŠ€è¡“ï¼Œè®“æ¯ä¸€ç­†å–„æ„éƒ½è¢«çœ‹è¦‹ã€è¢«è¨˜éŒ„ã€è¢«æ”¾å¤§ï¼Œç‚ºå…¨çƒå¼±å‹¢æ—ç¾¤å»ºç«‹å¯æŒçºŒæ”¯æŒçš„èƒ½é‡ç¶²çµ¡ã€‚"
  },
};


let currentLang = "en";
let selectedAccount = null;
let web3 = null;
const tokenAddress = "0x8CCAe437408C07A54a1b574894E2C541160Bbfed";
const tokenABI = [
  { "constant": true, "inputs": [{"name":"_owner","type":"address"}], "name": "balanceOf", "outputs": [{"name":"balance","type":"uint256"}], "type": "function" },
  { "constant": true, "inputs": [], "name": "decimals", "outputs": [{"name":"","type":"uint8"}], "type": "function" }
];

function changeLanguage() {
  const lang = document.getElementById("language").value;
  currentLang = lang;
  const t = translations[lang] || translations["en"];
  applyVisionTranslation(lang);

  document.getElementById("startBtn").innerText = t.start;
  document.getElementById("title").innerText = t.title;
  document.getElementById("label-address").innerText = t.address;
  document.getElementById("recipient").placeholder = t.enterAddress;
  document.getElementById("label-amount").innerText = t.amount;
  document.getElementById("amount").placeholder = t.enterAmount;
  document.getElementById("send").innerText = t.send;
  document.getElementById("back").innerText = `â† ${t.back}`;

  updateWalletDisplay();
}

function showTransferSection() {
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("transferSection").style.display = "block";
  updateWalletDisplay();
}

function goBack() {
  document.getElementById("transferSection").style.display = "none";
  document.getElementById("startBtn").style.display = "block";
}

async function connectWallet() {
  if (window.ethereum) {
    try {
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      selectedAccount = accounts[0];
      web3 = new Web3(window.ethereum);
      updateWalletDisplay();
    } catch (err) {
      alert("Wallet connection rejected.");
    }
  } else {
    alert("MetaMask not detected");
  }
}
function showVision() {
  const vision = document.getElementById("vision");
  const btn = document.getElementById("showVisionBtn");

  const isHidden = vision.style.display === "none" || vision.style.display === "";
  if (isHidden) {
    vision.style.display = "block";
    btn.innerText = visionTranslations[currentLang]?.btn || "ğŸ”™ Back";
    applyVisionTranslation(currentLang); // å¥—ç”¨é¡˜æ™¯æ–‡ç¿»è­¯
    vision.scrollIntoView({ behavior: "smooth", block: "center" });
  } else {
    vision.style.display = "none";
    btn.innerText = visionTranslations[currentLang]?.btn || "ğŸŒ View Vision";
  }
}

async function updateWalletDisplay() {
  if (!web3 || !selectedAccount) {
    document.getElementById("wallet-balance").innerText = translations[currentLang].connect;
    return;
  }
  const t = translations[currentLang];

  try {
    const ethBalanceWei = await web3.eth.getBalance(selectedAccount);
    const ethBalance = web3.utils.fromWei(ethBalanceWei, 'ether');

    const tokenContract = new web3.eth.Contract(tokenABI, tokenAddress);
    const decimals = await tokenContract.methods.decimals().call();
    const tokenBalanceRaw = await tokenContract.methods.balanceOf(selectedAccount).call();
    const tokenBalance = tokenBalanceRaw / (10 ** decimals);

    document.getElementById("wallet-balance").innerText =
      `${t.ethBalance}: ${ethBalance} ETH | ${t.tokenBalance}: ${tokenBalance} MXN`;
  } catch (e) {
    console.error("Balance error:", e);
    document.getElementById("wallet-balance").innerText = "Error loading balances";
  }
}

function sendTransaction() {
  const recipient = document.getElementById("recipient").value;
  const amount = document.getElementById("amount").value;
  const errorEl = document.getElementById("transfer-error");
  const loadingEl = document.getElementById("transfer-loading");
  const successEl = document.getElementById("transfer-success");

function applyVisionTranslation(lang) {
  const vt = visionTranslations[lang] || visionTranslations["en"];
  document.getElementById("showVisionBtn").innerText = vt.btn;
  document.querySelector(".vision-short p").innerText = vt.short;
  document.querySelector(".vision-medium p").innerText = vt.medium;
  document.querySelector(".vision-long p").innerText = vt.long;
}


  // Reset all messages
  errorEl.style.display = "none";
  loadingEl.style.display = "block";
  successEl.style.display = "none";

  if (!web3.utils.isAddress(recipient)) {
    loadingEl.style.display = "none";
    errorEl.style.display = "block";
    return;
  }

  setTimeout(() => {
    loadingEl.style.display = "none";
    successEl.style.display = "block";
    console.log(`è½‰å¸³æˆåŠŸ To: ${recipient}, Amount: ${amount} MXN`);
  }, 1500); // æ¨¡æ“¬å»¶é²
}

window.addEventListener("DOMContentLoaded", () => {
  const langRaw = navigator.language || navigator.userLanguage; // ä¾‹å¦‚ "zh-TW"ã€"en-US"
  const langShort = langRaw.split('-')[0]; // ä¾‹å¦‚ "zh"ã€"en"
  const supportedLangs = Object.keys(translations);

  // åˆ¤æ–·ä½¿ç”¨è€…èªè¨€æ˜¯å¦è¢«æ”¯æ´
  let defaultLang = "en";
  if (supportedLangs.includes(langRaw)) {
    defaultLang = langRaw;
  } else if (supportedLangs.includes(langShort)) {
    defaultLang = langShort;
  }

  // å¥—ç”¨èªè¨€
  document.getElementById("language").value = defaultLang;
  currentLang = defaultLang;
  changeLanguage();

  // é¡¯ç¤ºæç¤º
  const notice = document.createElement("div");
  notice.innerText = `ğŸ”¤ èªè¨€å·²è‡ªå‹•åˆ‡æ›ç‚ºï¼š${translations[defaultLang].title || defaultLang}`;
  notice.style.position = "fixed";
  notice.style.bottom = "20px";
  notice.style.left = "50%";
  notice.style.transform = "translateX(-50%)";
  notice.style.background = "rgba(0, 0, 0, 0.7)";
  notice.style.color = "#FFD700";
  notice.style.padding = "10px 16px";
  notice.style.borderRadius = "10px";
  notice.style.fontSize = "14px";
  notice.style.zIndex = "999";
  notice.style.animation = "fadeIn 0.5s ease-in-out";

  document.body.appendChild(notice);

  // å¹¾ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
  setTimeout(() => {
    notice.style.transition = "opacity 0.5s";
    notice.style.opacity = 0;
    setTimeout(() => notice.remove(), 600);
  }, 2500);

  // é»éŒ¢åŒ…é¤˜é¡å³å¯é€£æ¥
  document.getElementById("wallet-balance").addEventListener("click", connectWallet);
});

function toggleVision() {
  const visionEl = document.getElementById("vision");
  if (visionEl.style.display === "none" || visionEl.style.display === "") {
    visionEl.style.display = "block";
    applyVisionTranslation(currentLang); // åˆ‡æ›æ™‚å¥—ç”¨èªè¨€
  } else {
    visionEl.style.display = "none";
  }
}

function showVision() {
  const vision = document.getElementById("vision");
  const btn = document.getElementById("showVisionBtn");

  if (vision && btn) {
    // åˆ‡æ›é¡¯ç¤ºèˆ‡éš±è—
    if (vision.style.display === "none" || vision.style.display === "") {
      vision.style.display = "block";
      vision.scrollIntoView({ behavior: "smooth" });
      btn.innerText = "ğŸ”™ è¿”å› ";
    } else {
      vision.style.display = "none";
      btn.innerText = "ğŸŒ è§€çœ‹é¡˜æ™¯ ";
    }
  }
}

