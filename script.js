const translations = {
  "en": {
    "start": "Start Transfer",
    "title": "MetaXuan Coin",
    "address": "Recipient Address",
    "amount": "Amount",
    "enterAddress": "Enter recipient address",
    "enterAmount": "Enter amount",
    "send": "Send",
    "back": "Back",
    "balance": "Wallet Balance",
    "connect": "Connect Wallet",
    "connected": "Wallet Connected",
    "network": "Network",
    "ethBalance": "ETH Balance",
    "tokenBalance": "MXN Balance"
  },
  "zh-TW": {
    "start": "開始轉帳",
    "title": "玄元幣",
    "address": "接收地址",
    "amount": "轉帳金額",
    "enterAddress": "請輸入接收地址",
    "enterAmount": "請輸入金額",
    "send": "轉帳",
    "back": "返回",
    "balance": "錢包餘額",
    "connect": "連接錢包",
    "connected": "錢包已連接",
    "network": "網路",
    "ethBalance": "ETH 餘額",
    "tokenBalance": "MXN 餘額"
  }
  // ...其他語系請補全正確JSON後加入
};

const visionTranslations = {
  "en": {
    "btn": "🌍 View Vision",
    "short": "To listen to the voices of the world with compassion and wisdom.",
    "medium": "MetaXuan Coin is a bridge of kindness that transcends borders, empowering individuals to express compassion through decentralized support.",
    "long": "MetaXuan Coin is a global decentralized asset inspired by compassion and spiritual resonance. It serves not only as a symbol of good intentions but as a real means of exchange within a community driven by benevolence and purpose. With each transfer, a ripple of kindness is created, forming a network of mutual aid, transparency, and global spiritual awakening."
  },
  "zh-TW": {
    "btn": "🌍 觀看願景",
    "short": "傾聽世間的聲音，並以慈悲與智慧回應。",
    "medium": "玄元幣是一道連接人心的光，跨越疆界，讓每個人都能以善意與行動參與全球互助的浪潮。",
    "long": "玄元幣（MetaXuan Coin）是一項全球去中心化的資產，源於慈悲與靈性共鳴。它不僅是善意的象徵，更是實際可用的交換媒介，建立起一個以利他、透明與靈性覺醒為核心的社群網絡。每一次轉帳，都是一次能量的傳遞與善意的展現。"
  },
  "zh-CN": {
  "btn": "🌍 查看愿景",
  "short": "倾听世间的声音，并以慈悲与智慧，回应每一份需要。",
  "medium": "玄元币是一道连接人心的光，让全球的善意无国界地流动。我们相信，每一份温柔的力量，都能改变世界的角落。",
  "long": "玄元币（MetaXuan Coin）是一项全球性去中心化资产，致力于促进公平的资源分配与慈善透明。我们以六字大明咒「ॐ मणि पद्मे हूं」的精神为灵感，结合区块链技术，让每一笔善意都被看见、被记录、被放大，为全球弱势族群建立可持续支持的能量网络。"
   }, 
  "ja": {
    "visionBtn": "🌍 ビジョンを見る",
    "vision": {
      "short": "世界の声に耳を傾け、慈悲と知恵で応える。",
      "medium": "メタシュアンコインは人々の心をつなぐ光であり、善意が国境を越えて流れることを可能にします。私たちは、優しさが世界の一隅を変える力があると信じています。",
      "long": "MetaXuan Coinは「オム・マニ・ペメ・フム」の精神に触発された、グローバルな分散型資産です。ブロックチェーン技術と組み合わせて、公平な資源分配と慈善の透明性を促進します。"
      },
  "ko": {
    "visionBtn": "🌍 비전 보기",
    "vision": {
      "short": "세상의 목소리에 귀 기울이고, 자비와 지혜로 응답합니다.",
      "medium": "메타쉬안코인은 사람들의 마음을 연결하는 빛이며, 선의가 국경을 초월해 흐르게 합니다. 우리는 부드러운 힘이 세상을 바꿀 수 있다고 믿습니다.",
      "long": "MetaXuan Coin은 '옴 마니 파드메 훔'의 정신에서 영감을 받은 글로벌 분산형 자산으로, 블록체인 기술을 통해 공정한 자원 분배와 자선 투명성을 촉진합니다."
      },
  "es": {
    "visionBtn": "🌍 Ver Visión",
    "vision": {
      "short": "Escuchar las voces del mundo y responder con compasión y sabiduría.",
      "medium": "MetaXuan Coin es una luz que conecta corazones, permitiendo que la bondad fluya sin fronteras. Creemos que cada acto de bondad puede cambiar el mundo.",
      "long": "MetaXuan Coin es un activo descentralizado global inspirado en el mantra 'Om Mani Padme Hum', que promueve una distribución justa de recursos y transparencia en la caridad a través de la tecnología blockchain."
      },
  "th": {
    "visionBtn": "🌍 ดูวิสัยทัศน์",
    "vision": {
      "short": "ฟังเสียงของโลกและตอบสนองด้วยเมตตาและปัญญา",
      "medium": "MetaXuan Coin เป็นแสงที่เชื่อมหัวใจ ให้ความเมตตาไหลเวียนข้ามพรมแดน เราเชื่อว่าความเมตตาเล็ก ๆ ก็เปลี่ยนแปลงโลกได้",
      "long": "MetaXuan Coin เป็นทรัพย์สินแบบกระจายอำนาจระดับโลกที่ได้รับแรงบันดาลใจจากมนต์ 'โอม มณี ปัทเม หุม' ใช้เทคโนโลยีบล็อกเชนในการส่งเสริมความโปร่งใสและความเป็นธรรมในทรัพยากร"
      },
  "vi": {
    "visionBtn": "🌍 Xem Tầm Nhìn",
    "vision": {
      "short": "Lắng nghe thế giới bằng lòng từ bi và trí tuệ.",
      "medium": "MetaXuan Coin là ánh sáng kết nối trái tim, cho lòng tốt lan tỏa không biên giới. Mỗi hành động tử tế đều có thể thay đổi thế giới.",
      "long": "MetaXuan Coin là tài sản phi tập trung toàn cầu, lấy cảm hứng từ thần chú 'Om Mani Padme Hum', thúc đẩy sự công bằng và minh bạch trong từ thiện qua công nghệ blockchain."
     },
  "fr": {
    "visionBtn": "🌍 Voir la vision",
    "vision": {
      "short": "Écouter les voix du monde et répondre avec compassion et sagesse.",
      "medium": "MetaXuan Coin est une lumière reliant les cœurs, permettant à la bonté de circuler sans frontières. Chaque geste de bonté peut transformer le monde.",
      "long": "MetaXuan Coin est un actif décentralisé mondial inspiré par le mantra « Om Mani Padme Hum », favorisant la transparence et l'équité dans la redistribution des ressources via la blockchain."
     },
  "de": {
    "visionBtn": "🌍 Vision anzeigen",
    "vision": {
      "short": "Den Stimmen der Welt zuhören und mit Mitgefühl und Weisheit antworten.",
      "medium": "MetaXuan Coin ist ein Licht, das Herzen verbindet und Güte über Grenzen hinweg fließen lässt. Jeder Akt der Güte kann die Welt verändern.",
      "long": "MetaXuan Coin ist ein globales, dezentralisiertes Asset, inspiriert vom Mantra „Om Mani Padme Hum“, das Transparenz und Fairness im karitativen Bereich durch Blockchain-Technologie fördert."
     },
  "hi": {
    "visionBtn": "🌍 दृष्टिकोण देखें",
    "vision": {
      "short": "दुनिया की आवाज़ को सुनें और करुणा व बुद्धि से उत्तर दें।",
      "medium": "मेटा ज़ुआन कॉइन एक ऐसा प्रकाश है जो दिलों को जोड़ता है, जिससे दया की धाराएं सीमाओं से परे बहती हैं। हम मानते हैं कि हर एक कोमल प्रयास दुनिया को बदल सकता है।",
      "long": "मेटा ज़ुआन कॉइन एक वैश्विक विकेंद्रीकृत संपत्ति है जो 'ॐ मणि पद्मे हूं' मंत्र से प्रेरित है और ब्लॉकचेन तकनीक के माध्यम से पारदर्शिता और निष्पक्षता को बढ़ावा देता है।"
    }
  }
};

let currentLang = "en";
let selectedAccount = null;
let web3 = null;

const tokenAddress = "0x8CCAe437408C07A54a1b574894E2C541160Bbfed";
const tokenABI = [
  {
    "constant": true,
    "inputs": [{ "name": "_owner", "type": "address" }],
    "name": "balanceOf",
    "outputs": [{ "name": "balance", "type": "uint256" }],
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "decimals",
    "outputs": [{ "name": "", "type": "uint8" }],
    "type": "function"
  }
];
function changeLanguage() {
  const lang = document.getElementById("language").value;
  currentLang = lang;

  const t = translations[lang] || translations["en"];
  const vt = visionTranslations[lang] || visionTranslations["en"];

  // 一般介面翻譯
  document.getElementById("startBtn").innerText = t.start;
  document.getElementById("title").innerText = t.title;
  document.getElementById("label-address").innerText = t.address;
  document.getElementById("recipient").placeholder = t.enterAddress;
  document.getElementById("label-amount").innerText = t.amount;
  document.getElementById("amount").placeholder = t.enterAmount;
  document.getElementById("send").innerText = t.send;
  document.getElementById("back").innerText = `← ${t.back}`;
  document.getElementById("wallet-balance").innerText = t.connect;

  // 願景翻譯
  document.getElementById("showVisionBtn").innerText = vt.btn;
  document.getElementById("vision-short").innerText = vt.short;
  document.getElementById("vision-medium").innerText = vt.medium;
  document.getElementById("vision-long").innerText = vt.long;

  updateWalletDisplay(); // 更新餘額顯示
}

function showTransferSection() {
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("transferSection").style.display = "block";
  updateWalletDisplay();
}

function goBack() {
  document.getElementById("transferSection").style.display = "none";
  document.getElementById("startBtn").style.display = "block";
  window.addEventListener("DOMContentLoaded", () => {
  const langRaw = navigator.language || navigator.userLanguage; // 例如 "zh-TW"、"en-US"
  const langShort = langRaw.split('-')[0]; // 例如 "zh"、"en"
  const supportedLangs = Object.keys(translations);

  // 判斷使用者語言是否被支援
  let defaultLang = "en";
  if (supportedLangs.includes(langRaw)) {
    defaultLang = langRaw;
  } else if (supportedLangs.includes(langShort)) {
    defaultLang = langShort;
  }

  // 套用語言
  document.getElementById("language").value = defaultLang;
  currentLang = defaultLang;
  changeLanguage();

  // 顯示提示
  const notice = document.createElement("div");
  notice.innerText = `🔤 語言已自動切換為：${translations[defaultLang].title || defaultLang}`;
  notice.style.position = "fixed";
  notice.style.bottom = "20px";
  notice.style.left = "50%";
  notice.style.transform = "translateX(-50%)";
  notice.style.background = "rgba(0, 0, 0, 0.7)";
  notice.style.color = "#FFD700";
  notice.style.padding = "10px 16px";
  notice.style.borderRadius = "10px";
  notice.style.fontSize = "14px";
  notice.style.zIndex = "999";
  notice.style.animation = "fadeIn 0.5s ease-in-out";

  document.body.appendChild(notice);

  // 幾秒後自動消失
  setTimeout(() => {
    notice.style.transition = "opacity 0.5s";
    notice.style.opacity = 0;
    setTimeout(() => notice.remove(), 600);
  }, 2500);

  // 點錢包餘額即可連接
  document.getElementById("wallet-balance").addEventListener("click", connectWallet);
});
  function toggleVision() {
  const visionEl = document.getElementById("vision");
  if (visionEl.style.display === "none" || visionEl.style.display === "") {
    visionEl.style.display = "block";
    changeLanguage(); // 用已定義好的函數重新套用翻譯
  } else {
    visionEl.style.display = "none";
  }
}

function showVision() {
  const vision = document.getElementById("vision");
  const btn = document.getElementById("showVisionBtn");

  if (vision && btn) {
    const vt = visionTranslations[currentLang] || visionTranslations["en"];
    const isHidden = vision.style.display === "none" || vision.style.display === "";

    vision.style.display = isHidden ? "block" : "none";
    if (vt.visionBtn) {
      btn.innerText = isHidden ? "🔙 " + (translations[currentLang]?.back || "Back") : vt.visionBtn;
    } else if (vt.btn) {
      btn.innerText = isHidden ? "🔙 " + (translations[currentLang]?.back || "Back") : vt.btn;
    }

    if (isHidden) vision.scrollIntoView({ behavior: "smooth" });
  }
}
